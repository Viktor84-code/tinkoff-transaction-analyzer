# test_filter.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º src –≤ –ø—É—Ç—å
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

# –¢–µ–ø–µ—Ä—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º
try:
    import utils
    print("‚úÖ –ú–æ–¥—É–ª—å utils —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("–¢–µ–∫—É—â–∏–π sys.path:", sys.path)
    exit(1)

print("üß™ –¢–ï–°–¢ filter_by_date")
print("=" * 40)

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
df = utils.read_transactions("data/operations.xlsx")
print(f"üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {len(df)} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")

# –¢–µ—Å—Ç 1: –î–µ–∫–∞–±—Ä—å 2021
print("\nüìÖ –¢–µ—Å—Ç 1: –î–µ–∫–∞–±—Ä—å 2021")
filtered = utils.filter_by_date(df, "2021-12-01", "2021-12-31")
print(f"   –ù–∞–π–¥–µ–Ω–æ: {len(filtered)} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")

if len(filtered) > 0:
    print("   ‚úÖ –£–°–ü–ï–•! –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!")
    # –ü–æ–∫–∞–∂–µ–º –ø—Ä–∏–º–µ—Ä
    first = filtered.iloc[0]
    print(f"   –ü—Ä–∏–º–µ—Ä: {first['–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏']} - {first['–ö–∞—Ç–µ–≥–æ—Ä–∏—è']} - {first['–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞']} —Ä—É–±")
else:
    print("   ‚ùå –ü—Ä–æ–±–ª–µ–º–∞! –ù—É–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏")

# –¢–µ—Å—Ç 2: –Ø–Ω–≤–∞—Ä—å 2022
print("\nüìÖ –¢–µ—Å—Ç 2: –Ø–Ω–≤–∞—Ä—å 2022")
filtered2 = utils.filter_by_date(df, "2022-01-01", "2022-01-31")
print(f"   –ù–∞–π–¥–µ–Ω–æ: {len(filtered2)} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")

# –¢–µ—Å—Ç 3: –í–µ—Å—å 2021 –≥–æ–¥
print("\nüìÖ –¢–µ—Å—Ç 3: –í–µ—Å—å 2021 –≥–æ–¥")
filtered3 = utils.filter_by_date(df, "2021-01-01", "2021-12-31")
print(f"   –ù–∞–π–¥–µ–Ω–æ: {len(filtered3)} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")
